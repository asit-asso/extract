<div>
    <p>Le plugin d'extraction FME Desktop V2 permet d'ex&eacute;cuter un script avec FME Desktop en surmontant les limitations de longueur de ligne de commande.</p>

    <h4>M&eacute;thode de transmission des param&egrave;tres</h4>
    <p>
        Contrairement &agrave; la version classique, ce plugin transmet les param&egrave;tres via un fichier GeoJSON nomm&eacute; <code>parameters.json</code>
        cr&eacute;&eacute; dans le r&eacute;pertoire de sortie. Le workspace FME re&ccedil;oit le chemin de ce fichier via le param&egrave;tre <code>--PARAM_FILE</code>.
    </p>

    <h4>Structure du fichier GeoJSON</h4>
    <p>Le fichier est un objet GeoJSON de type Feature contenant&nbsp;:</p>
    <ul>
        <li><strong>geometry</strong> : La g&eacute;om&eacute;trie du p&eacute;rim&egrave;tre (convertion automatique du WKT en GeoJSON)</li>
        <li><strong>properties</strong> : Tous les param&egrave;tres de la requ&ecirc;te</li>
    </ul>

    <h4>Param&egrave;tres disponibles dans le fichier GeoJSON</h4>
    <p>Les propri&eacute;t&eacute;s suivantes sont disponibles dans le fichier GeoJSON&nbsp;:</p>

    <table class="popover-table parameter-table">
        <tbody>
            <tr>
                <td class="popover-table-header">
                    <p>Param&egrave;tre</p>
                </td>

                <td class="popover-table-header">
                    <p>Description</p>
                </td>
                <td class="popover-table-header">
                    <p>Type</p>
                </td>
                <td class="popover-table-header">
                    <p>Exemple</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>RequestId</p>
                </td>
                <td class="popover-table-data">
                    <p>Identifiant de commande interne Extract</p>
                </td>
                <td class="popover-table-data">
                    <p>Entier</p>
                </td>
                <td class="popover-table-data">
                    <p>365</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>FolderOut</p>
                </td>
                <td class="popover-table-data">
                    <p>R&eacute;pertoire de sortie o&ugrave; doivent &ecirc;tre &eacute;crits les fichiers cr&eacute;&eacute;s</p>
                </td>
                <td class="popover-table-data">
                    <p>Cha&icirc;ne</p>
                </td>
                <td class="popover-table-data">
                    <p>/var/extract/orders/5382e46f-9d5d-4fdd-adbc-828165d4be82/output/</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>FolderIn</p>
                </td>
                <td class="popover-table-data">
                    <p>R&eacute;pertoire contenant les donn&eacute;es d'entr&eacute;e</p>
                </td>
                <td class="popover-table-data">
                    <p>Cha&icirc;ne</p>
                </td>
                <td class="popover-table-data">
                    <p>/var/extract/orders/5382e46f-9d5d-4fdd-adbc-828165d4be82/input/</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>OrderGuid</p>
                </td>
                <td class="popover-table-data">
                    <p>Identifiant unique de la commande</p>
                </td>
                <td class="popover-table-data">
                    <p>GUID&nbsp;/ UUID</p>
                </td>
                <td class="popover-table-data">
                    <p>5382e46f-9d5d-4fdd-adbc-828165d4be82</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>OrderLabel</p>
                </td>
                <td class="popover-table-data">
                    <p>Libell&eacute; de commande externe</p>
                </td>
                <td class="popover-table-data">
                    <p>Texte</p>
                </td>
                <td class="popover-table-data">
                    <p>221587</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>ClientGuid</p>
                </td>
                <td class="popover-table-data">
                    <p>Identifiant unique du client</p>
                </td>
                <td class="popover-table-data">
                    <p>GUID&nbsp;/ UUID</p>
                </td>
                <td class="popover-table-data">
                    <p>94d47632-b0e9-57f4-6580-58925e3f9a88</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>ClientName</p>
                </td>
                <td class="popover-table-data">
                    <p>Nom du client qui a pass&eacute; la commande</p>
                </td>
                <td class="popover-table-data">
                    <p>Texte</p>
                </td>
                <td class="popover-table-data">
                    <p>Jean Dupont</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>OrganismGuid</p>
                </td>
                <td class="popover-table-data">
                    <p>Identifiant unique de l'organisme</p>
                </td>
                <td class="popover-table-data">
                    <p>GUID&nbsp;/ UUID</p>
                </td>
                <td class="popover-table-data">
                    <p>2edc1a50-4837-4c44-1519-3ebc85f14588</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>OrganismName</p>
                </td>
                <td class="popover-table-data">
                    <p>Nom de l'organisme</p>
                </td>
                <td class="popover-table-data">
                    <p>Texte</p>
                </td>
                <td class="popover-table-data">
                    <p>Service du cadastre</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>ProductGuid</p>
                </td>
                <td class="popover-table-data">
                    <p>Identifiant unique du produit command&eacute;</p>
                </td>
                <td class="popover-table-data">
                    <p>GUID&nbsp;/ UUID</p>
                </td>
                <td class="popover-table-data">
                    <p>a049fecb-30d9-9124-ed41-068b566a0855</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>ProductLabel</p>
                </td>
                <td class="popover-table-data">
                    <p>Libell&eacute; du produit command&eacute;</p>
                </td>
                <td class="popover-table-data">
                    <p>Texte</p>
                </td>
                <td class="popover-table-data">
                    <p>Plan cadastral</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>Parameters</p>
                </td>
                <td class="popover-table-data">
                    <p>Objet JSON contenant les param&egrave;tres personnalis&eacute;s de la requ&ecirc;te</p>
                </td>
                <td class="popover-table-data">
                    <p>Objet JSON</p>
                </td>
                <td class="popover-table-data">
                    <p>{"FORMAT" : "SHP", "PROJECTION" : "EPSG:2056"}</p>
                </td>
            </tr>
        </tbody>
    </table>

    <h4>G&eacute;om&eacute;trie (geometry)</h4>
    <p>
        La g&eacute;om&eacute;trie du p&eacute;rim&egrave;tre est automatiquement convertie du format WKT (WGS84) vers le format GeoJSON.
        Elle est plac&eacute;e dans la propri&eacute;t&eacute; <code>geometry</code> de l'objet Feature.
    </p>

    <h4>Exemple de fichier parameters.json</h4>
    <pre>{
  "type": "Feature",
  "geometry": {
    "type": "Polygon",
    "coordinates": [[
      [6.886727164248283, 46.44372031957538],
      [6.881351862162561, 46.44126511019801],
      [6.886480507180103, 46.43919870486726],
      [6.893221678307809, 46.441705238743005],
      [6.886727164248283, 46.44372031957538]
    ]]
  },
  "properties": {
    "RequestId": 365,
    "FolderOut": "/var/extract/orders/5382e46f-9d5d-4fdd-adbc-828165d4be82/output/",
    "FolderIn": "/var/extract/orders/5382e46f-9d5d-4fdd-adbc-828165d4be82/input/",
    "OrderGuid": "5382e46f-9d5d-4fdd-adbc-828165d4be82",
    "OrderLabel": "221587",
    "ClientGuid": "94d47632-b0e9-57f4-6580-58925e3f9a88",
    "ClientName": "Jean Dupont",
    "OrganismGuid": "2edc1a50-4837-4c44-1519-3ebc85f14588",
    "OrganismName": "Service du cadastre",
    "ProductGuid": "a049fecb-30d9-9124-ed41-068b566a0855",
    "ProductLabel": "Plan cadastral",
    "Parameters": {
      "FORMAT": "SHP",
      "PROJECTION": "EPSG:2056"
    }
  }
}</pre>

    <h4>Utilisation dans FME</h4>
    <p>
        Le workspace FME peut lire ce fichier avec un Reader GeoJSON ou FeatureReader en utilisant le param&egrave;tre
        <code>$(PARAM_FILE)</code> comme source. Les attributs sont directement accessibles et la g&eacute;om&eacute;trie
        est automatiquement import&eacute;e.
    </p>

    <h4>Sortie</h4>
    <p>
        Les fichiers de sortie du script doivent &ecirc;tre &eacute;crits dans le r&eacute;pertoire indiqu&eacute; par <code>FolderOut</code>.
        Le script doit retourner un code de sortie de 0 si le traitement a r&eacute;ussi.
    </p>
</div>