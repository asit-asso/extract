<div>
    <p>The FME Desktop V2 extraction plugin allows you to run a script with FME Desktop by overcoming command line length limitations.</p>

    <h4>Parameter Transmission Method</h4>
    <p>
        Unlike the classic version, this plugin transmits parameters via a GeoJSON file named <code>parameters.json</code>
        created in the output directory. The FME workspace receives the path to this file via the <code>--parametersFile</code> parameter.

        The command parameters are stored in a GeoJSON file, with the command's bounding box polygon in WGS84 as the only feature. Other parameters are contained in the feature's properties.
        Only the file path is passed to the script with the parametersFile parameter (the FME script must read this file and extract the desired parameters).
    </p>

    <h4>GeoJSON File Structure</h4>
    <p>The file is a GeoJSON Feature object containing:</p>
    <ul>
        <li><strong>geometry</strong>: The perimeter geometry in WGS84 (automatic conversion from WKT to GeoJSON)</li>
        <li><strong>properties</strong>: All request parameters</li>
    </ul>

    <h4>Available Parameters in the GeoJSON File</h4>
    <p>The following properties are available in the GeoJSON file:</p>

    <table class="popover-table parameter-table">
        <tbody>
            <tr>
                <td class="popover-table-header">
                    <p>Parameter</p>
                </td>

                <td class="popover-table-header">
                    <p>Description</p>
                </td>
                <td class="popover-table-header">
                    <p>Type</p>
                </td>
                <td class="popover-table-header">
                    <p>Example</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>Request</p>
                </td>
                <td class="popover-table-data">
                    <p>Internal Extract order identifier</p>
                </td>
                <td class="popover-table-data">
                    <p>Integer</p>
                </td>
                <td class="popover-table-data">
                    <p>365</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>FolderOut</p>
                </td>
                <td class="popover-table-data">
                    <p>Output directory where created files should be written</p>
                </td>
                <td class="popover-table-data">
                    <p>String</p>
                </td>
                <td class="popover-table-data">
                    <p>/var/extract/orders/5382e46f-9d5d-4fdd-adbc-828165d4be82/output/</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>OrderGuid</p>
                </td>
                <td class="popover-table-data">
                    <p>Unique order identifier</p>
                </td>
                <td class="popover-table-data">
                    <p>GUID / UUID</p>
                </td>
                <td class="popover-table-data">
                    <p>5382e46f-9d5d-4fdd-adbc-828165d4be82</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>OrderLabel</p>
                </td>
                <td class="popover-table-data">
                    <p>External order label</p>
                </td>
                <td class="popover-table-data">
                    <p>Text</p>
                </td>
                <td class="popover-table-data">
                    <p>221587</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>ClientGuid</p>
                </td>
                <td class="popover-table-data">
                    <p>Unique client identifier</p>
                </td>
                <td class="popover-table-data">
                    <p>GUID / UUID</p>
                </td>
                <td class="popover-table-data">
                    <p>94d47632-b0e9-57f4-6580-58925e3f9a88</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>ClientName</p>
                </td>
                <td class="popover-table-data">
                    <p>Name of the client who placed the order</p>
                </td>
                <td class="popover-table-data">
                    <p>Text</p>
                </td>
                <td class="popover-table-data">
                    <p>John Doe</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>OrganismGuid</p>
                </td>
                <td class="popover-table-data">
                    <p>Unique organization identifier</p>
                </td>
                <td class="popover-table-data">
                    <p>GUID / UUID</p>
                </td>
                <td class="popover-table-data">
                    <p>2edc1a50-4837-4c44-1519-3ebc85f14588</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>OrganismName</p>
                </td>
                <td class="popover-table-data">
                    <p>Organization name</p>
                </td>
                <td class="popover-table-data">
                    <p>Text</p>
                </td>
                <td class="popover-table-data">
                    <p>Land Registry Office</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>ProductGuid</p>
                </td>
                <td class="popover-table-data">
                    <p>Unique identifier of the ordered product</p>
                </td>
                <td class="popover-table-data">
                    <p>GUID / UUID</p>
                </td>
                <td class="popover-table-data">
                    <p>a049fecb-30d9-9124-ed41-068b566a0855</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>ProductLabel</p>
                </td>
                <td class="popover-table-data">
                    <p>Label of the ordered product</p>
                </td>
                <td class="popover-table-data">
                    <p>Text</p>
                </td>
                <td class="popover-table-data">
                    <p>Cadastral plan</p>
                </td>
            </tr>
            <tr>
                <td class="popover-table-data">
                    <p>Parameters</p>
                </td>
                <td class="popover-table-data">
                    <p>JSON object containing custom request parameters</p>
                </td>
                <td class="popover-table-data">
                    <p>JSON Object</p>
                </td>
                <td class="popover-table-data">
                    <p>{"FORMAT" : "SHP", "PROJECTION" : "EPSG:2056"}</p>
                </td>
            </tr>
        </tbody>
    </table>

    <h4>Example of parameters.json file</h4>
    <pre>{
  "type": "Feature",
  "geometry": {
    "type": "Polygon",
    "coordinates": [[
      [6.886727164248283, 46.44372031957538],
      [6.881351862162561, 46.44126511019801],
      [6.886480507180103, 46.43919870486726],
      [6.893221678307809, 46.441705238743005],
      [6.886727164248283, 46.44372031957538]
    ]]
  },
  "properties": {
    "Request": 365,
    "FolderOut": "/var/extract/orders/5382e46f-9d5d-4fdd-adbc-828165d4be82/output/",
    "OrderGuid": "5382e46f-9d5d-4fdd-adbc-828165d4be82",
    "OrderLabel": "221587",
    "ClientGuid": "94d47632-b0e9-57f4-6580-58925e3f9a88",
    "ClientName": "Jean Dupont",
    "OrganismGuid": "2edc1a50-4837-4c44-1519-3ebc85f14588",
    "OrganismName": "Land Registry Office",
    "ProductGuid": "a049fecb-30d9-9124-ed41-068b566a0855",
    "ProductLabel": "Cadastral plan",
    "Parameters": {
      "FORMAT": "SHP",
      "SELECTION" : "PASS_THROUGH",
      "PROJECTION" : "SWITZERLAND95",
      "REMARK" : "bla bla bla",
      "CLIENT_LANG" : "fr"
    }
  }
}</pre>

    <h4>Usage in FME</h4>
    <p>
        The FME workspace can read this file with a GeoJSON Reader or FeatureReader using the
        <code>$(parametersFile)</code> parameter as source. Attributes are directly accessible and geometry
        is automatically imported.
    </p>

    <h4>Output</h4>
    <p>
        Output files from the script should be written to the directory indicated by <code>FolderOut</code>.
        The script must return an exit code of 0 if processing was successful.
    </p>
</div>
