<!-- en: English -->
<div>
    <h3>Python Plugin for Extract</h3>

    <p>This plugin lets you run custom Python scripts as part of an Extract process.
        The request parameters are passed to the script via a JSON file.</p>

    <h4>Required parameters:</h4>
    <ul>
        <li><b>Python Interpreter:</b> The full path to the Python executable (e.g., /usr/bin/python3, C:\Python39\python.exe)</li>
        <li><b>Python Script:</b> The full path to the Python script to run</li>
    </ul>

    <h4>Optional parameters:</h4>
    <ul>
        <li><b>Additional arguments:</b> Extra arguments to pass to the Python script</li>
    </ul>

    <h4>How it works:</h4>
    <ol>
        <li>The plugin creates a <code>parameters.json</code> file in the output folder containing all request information</li>
        <li>The Python script is executed with the JSON file path as the first argument</li>
        <li>The script must save its results in the specified output folder (<code>folderOut</code>)</li>
        <li>The script must return 0 on success; any other value indicates an error</li>
    </ol>

    <h4>parameters.json structure:</h4>
    <pre>{
    "requestId": "Request ID",
    "folderOut": "Output folder",
    "folderIn": "Input folder",
    "order": {
        "guid": "Order GUID",
        "label": "Order label"
    },
    "client": {
        "guid": "Client GUID",
        "details": "Client details"
    },
    "organism": {
        "guid": "Organization GUID",
        "details": "Organization details"
    },
    "productGuid": "Product GUID",
    "productLabel": "Product label",
    "parameters": {
        // Request-specific parameters
    },
    "perimeter": {
        // Geometry in GeoJSON format
    }
}</pre>

    <h4>Example Python script:</h4>
    <pre>#!/usr/bin/env python3
import json
import sys
import os

def main():
    if len(sys.argv) < 2:
        print("Error: path to parameters.json is required")
        return 1

    # Load parameters
    with open(sys.argv[1], 'r') as f:
        params = json.load(f)

    # Get output folder
    output_dir = params['folderOut']

    # Process the request
    # ... your code here ...

    # Save results
    result_file = os.path.join(output_dir, 'result.txt')
    with open(result_file, 'w') as f:
        f.write("Processing completed successfully")

    return 0

if __name__ == '__main__':
    sys.exit(main())
</pre>

    <h4>Important notes:</h4>
    <ul>
        <li>The Python script must be executable and have appropriate permissions</li>
        <li>The Python interpreter must be installed on the Extract server</li>
        <li>Required Python dependencies must be installed</li>
        <li>The script runs in the context of the output folder</li>
    </ul>
</div>
